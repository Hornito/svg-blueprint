!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.svgBlueprint={})}(this,function(t){var e={width:"400px",height:"300px",parentElement:null,parentSelector:"body",className:"svg-blueprint",backgroundColor:"#3177C6",gridColor:"#fff",gridOpacity:.3,cursorColor:"#0b64c4",cursorOpacity:1,axisColor:"#f4b916",axisOpacity:.5,nonScalingStroke:!0,strokeWidth:2,zoomFactor:.05,zoomDirection:1,zoomLimit:{min:1e-4,max:1e4},fitPadding:42,stroke:"#fff",fill:"none",statusbarStyle:{left:"5px",bottom:"5px",padding:"5px",color:"#222","background-color":"#fff","border-radius":"5px","font-family":"monospace","text-transform":"uppercase"}},i=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),Array.isArray(t)?(e=t[1]||0,t=t[0]||0):void 0!==t.x&&(e=t.y||0,t=t.x||0),this.x=parseFloat(t),this.y=parseFloat(e)};i.prototype.add=function(t){var e=new i(t);return new i(this.x+e.x,this.y+e.y)},i.prototype.sub=function(t){var e=new i(t);return new i(this.x-e.x,this.y-e.y)},i.prototype.mult=function(t){var e=new i(t,t);return new i(this.x*e.x,this.y*e.y)},i.prototype.div=function(t){var e=new i(t,t);return new i(this.x/e.x,this.y/e.y)},i.prototype.neg=function(){return new i(-this.x,-this.y)},i.prototype.distance=function(t){var e=this.sub(t),i=e.mult(e);return Math.sqrt(i.x+i.y)},i.prototype.midpoint=function(t){return this.add(new i(t).sub(this).mult(.5))},i.prototype.toArray=function(){return[this.x,this.y]},i.prototype.clone=function(){return new i(this.x,this.y)};var n="http://www.w3.org/2000/svg",o=!1;try{var s=Object.defineProperty({},"passive",{get:function(){return o=!0}});window.addEventListener("testPassive",null,s),window.removeEventListener("testPassive",null,s)}catch(t){}function r(t,e,i){var n=!!o&&{passive:!0},s=e;"string"==typeof s&&(s=s.trim().split(/[\s,]+/)),s.forEach(function(e){null===i?t.removeEventListener(e,i,n):t.addEventListener(e,i,n)})}function a(t,e,i){if(void 0===i&&(i=null),"string"!=typeof e)for(var n=0,o=Object.keys(e);n<o.length;n+=1){var s=o[n];r(t,s,e[s])}else r(t,e,i)}function p(t,e,i){if(void 0===i&&(i=null),"string"!=typeof e)for(var n=0,o=Object.keys(e);n<o.length;n+=1){var s=o[n];p(t,s,e[s])}else null===i?t.style.removeProperty(e):t.style.setProperty(e,i)}function h(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),null!==e){var n=t.getAttribute("transform")||"",o={};"string"==typeof e?o[e]=i:o=e;for(var s=0,r=Object.keys(o);s<r.length;s+=1){var a=r[s],p=o[a];n=n.replace(new RegExp(a+"\\([^)]+\\)","g"),""),null!==p&&(Array.isArray(p)?n+=a+"("+p.join(" ")+") ":n+=a+"("+p+") ")}l(t,"transform",n=n.replace(/\s+/," ").trim())}else l(t,"transform",null)}function l(t,e,i){if(void 0===i&&(i=null),"string"!=typeof e)for(var n=0,o=Object.keys(e);n<o.length;n+=1){var s=o[n];"style"===s?p(t,e[s]):"event"===s?a(t,e[s]):"transform"===s?h(t,e[s]):l(t,s,e[s])}else null===i?t.removeAttribute(e):t.setAttribute(e,i)}var c=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),Array.isArray(t)?(e=t[1]||0,t=t[0]||0):void 0!==t.x&&(e=t.y||0,t=t.x||0),this.x=parseFloat(t),this.y=parseFloat(e)};c.prototype.add=function(t){var e=new c(t);return new c(this.x+e.x,this.y+e.y)},c.prototype.sub=function(t){var e=new c(t);return new c(this.x-e.x,this.y-e.y)},c.prototype.mult=function(t){var e=new c(t,t);return new c(this.x*e.x,this.y*e.y)},c.prototype.div=function(t){var e=new c(t,t);return new c(this.x/e.x,this.y/e.y)},c.prototype.neg=function(){return new c(-this.x,-this.y)},c.prototype.distance=function(t){var e=this.sub(t),i=e.mult(e);return Math.sqrt(i.x+i.y)},c.prototype.midpoint=function(t){return this.add(new c(t).sub(this).mult(.5))},c.prototype.toArray=function(){return[this.x,this.y]},c.prototype.clone=function(){return new c(this.x,this.y)};var u=function(t){this.event=t,this.id=t.pointerId,this.position=new c,this.movement=new c,this.distance=0,this.down=!1,this.downTime=0,this.upTime=0,this.tapCount=0,this.tapDuration=0,this.panning=!1,this.panDistance=0,this.panStartPosition=0,this.panOffsets=new c,this.pinch=null,this.pinchRatio=1,this.pinchDistance=0,this.pinchMidpoint=0,this.pinchOffset=0,this.primary=!1};u.prototype.clone=function(){for(var t={},e=0,i=Object.keys(this);e<i.length;e+=1){var n=i[e],o=this[n];o&&o instanceof c&&(o=o.clone()),t[n]=o}return t};var d={panThreshold:10,tapThreshold:200,tapTimeout:500},f=["pointerover","pointerenter","pointerdown","pointermove","pointerup","pointercancel","pointerout","pointerleave","gotpointercapture","lostpointercapture"],m=function(t,e){var i=this;void 0===e&&(e={}),this.target=t,this.settings=Object.assign({},d,e),this.callbacks=[],this.pointers=new Map,this.tapCount=0,this.tapTimeout=null,this.wheelTimeout=null,p(t,"touch-action","none"),a(t,f.join(","),function(t){i.trackPointer(t)}),a(t,"pointerleave pointercancel lostpointercapture",function(t){i.deletePointer(t.pointerId)}),a(t,"wheel",function(t){i.onMouseWheel(t)})};m.prototype.hasPointer=function(t){return this.pointers.has(t)},m.prototype.getPointer=function(t){return this.pointers.get(t)},m.prototype.setPointer=function(t){this.pointers.set(t.id,t)},m.prototype.deletePointer=function(t){this.pointers.has(t)&&this.pointers.delete(t)},m.prototype.getPosition=function(t){var e=this.target.getBoundingClientRect();return new c(t.pageX-e.left,t.pageY-e.top)},m.prototype.tapRecognizer=function(t,e){var i=this;if("up"===t){var n=e.upTime-e.downTime;n>this.settings.tapThreshold||(this.tapTimeout&&clearTimeout(this.tapTimeout),e.tapCount=++this.tapCount,e.tapDuration=n,1===this.tapCount&&this.emit("tap.start",e.clone()),this.emit("tap",e.clone()),this.tapTimeout=setTimeout(function(){i.emit("tap.end",e.clone()),i.tapCount=0},this.settings.tapTimeout))}},m.prototype.panRecognizer=function(t,e){"move"!==t?"down"!==t?-1===["up","leave","cancel","lostcapture"].indexOf(t)||e.panStartPosition&&(e.panning&&this.emit("pan.end",e.clone()),e.panOffsets=new c,e.panStartPosition=0,e.panDistance=0,e.panning=!1):e.panStartPosition||(e.panStartPosition=e.position.clone()):e.panStartPosition&&(e.panOffsets=e.position.sub(e.panStartPosition),e.panDistance=e.panStartPosition.distance(e.position),e.panning?this.emit("pan.move",e.clone()):e.panDistance>this.settings.panThreshold&&(e.panning=!0,this.emit("pan.start",e.clone())))},m.prototype.onPinch=function(t,e){var i=t.position.distance(e.position),n=t.position.midpoint(e.position),o=t.pinchOffset||i,s=i/t.pinchOffset;Object.assign(t,{pinchDistance:i,pinchMidpoint:n,pinchOffset:o,pinchRatio:s}),Object.assign(e,{pinchDistance:i,pinchMidpoint:n,pinchOffset:o,pinchRatio:s})},m.prototype.pinchRecognizer=function(t,e){if("move"!==t){if("down"===t){var i=null;return this.pointers.forEach(function(t){i||!t.down||t.pinch||t.id===e.id||(i=t)}),void(i&&(i.pinch=e,e.pinch=i,this.onPinch(i,e),this.emit("pinch.start",e.clone())))}var n=function(t){t.pinch=null,t.pinchRatio=1,t.pinchDistance=0,t.pinchMidpoint=0,t.pinchOffset=0};"up"!==t||e.pinch&&(this.emit("pinch.end",e.clone()),n(e.pinch),n(e))}else e.pinch&&(this.onPinch(e,e.pinch),this.emit("pinch.move",e.clone()))},m.prototype.trackPointer=function(t){var e=t.type.replace("pointer",""),i=this.getPointer(t.pointerId),n=this.getPosition(t);i||((i=new u(t)).primary=t.isPrimary,i.position=n,this.setPointer(i)),"move"===e?(i.distance=i.position.distance(n),i.movement=n.sub(i.position),i.position=n):"down"===e?(i.downTime=Date.now(),i.down=!0):"up"===e&&(i.upTime=Date.now(),i.down=!1),this.emit(e,i.clone()),this.tapRecognizer(e,i),this.panRecognizer(e,i),this.pinchRecognizer(e,i)},m.prototype.onMouseWheel=function(t){var e=this,i=t.deltaY>0?1:-1,n=new u(t);n.position=this.getPosition(t),n.delta=i,null===this.wheelTimeout&&this.emit("wheel.start",n),this.emit("wheel.move",n),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){e.wheelTimeout=null,e.emit("wheel.end",n)},120)},m.prototype.on=function(t,e){var i=this,n=t;"string"==typeof n&&(n=n.trim().split(/[\s,]+/)),n.forEach(function(t){i.callbacks.push({type:t,func:e})})},m.prototype.emit=function(t,e){void 0===e&&(e={}),this.callbacks.forEach(function(i){i.type!==t&&"*"!==i.type||i.func({type:t,data:e})})};var y=0,g=!!navigator.userAgent.match(/firefox/i),v=function(t){var n=this;void 0===t&&(t={}),this.uid=y++,this.settings=Object.assign({},e,t),this.parent=function(t){var e,i=t.parentElement,n=t.parentSelector;if(null!==i){if(!(i instanceof Element))throw new Error("Option { parentElement } must be of type Element.");return i}if(!(e=document.querySelector(n)))throw new Error("No parent found with the selector [ "+n+" ]");return e}(this.settings),this.elements=function(t,e){return void 0===e&&(e=null),function(t){var e={},i=document.createElement("div");i.innerHTML=t.trim();var n=i.querySelectorAll("[data-key]");return Array.prototype.forEach.call(n,function(t){e[t.getAttribute("data-key")]=t}),e}(e?function(t,e){return t.replace(/(\{\{([^}]+)\}\})/g,function(t,i,n){return e[n]||i})}(t,e):t)}('\n<div data-key="blueprint" class="{{className}} {{className}}-{{uid}}" style="position: relative; width: {{width}}; height: {{height}};">\n\n  <svg data-key="canvas" class="{{className}}-grid" style="position: relative; width: 100%; height: 100%; overflow: hidden;" xmlns="http://www.w3.org/2000/svg">\n\n    <defs>\n      <pattern id="gridPattern10" width="0.1" height="0.1">\n        <path data-key="gridPattern10" d="M 10 0 L 0 0 0 10" fill="none" stroke="{{gridColor}}" stroke-width="0.1" />\n      </pattern>\n      <pattern id="gridPattern100" width="1" height="1">\n        <path data-key="gridPattern100" d="M 100 0 L 0 0 0 100" fill="none" stroke="{{gridColor}}" stroke-width="1" />\n      </pattern>\n      <pattern data-key="gridPattern" id="gridPattern" width="100" height="100" patternUnits="userSpaceOnUse">\n        <rect data-key="gridFill10" fill="url(#gridPattern10)" width="100" height="100" />\n        <rect data-key="gridFill100" fill="url(#gridPattern100)" width="100" height="100" opacity="{{gridOpacity}}" />\n      </pattern>\n    </defs>\n\n    <rect data-key="background" class="{{className}}-background" width="100%" height="100%" fill="{{backgroundColor}}" />\n    <rect data-key="grid" class="{{className}}-grid" width="100%" height="100%" fill="url(#gridPattern)" />\n\n    <g data-key="axis" class="{{className}}-axis" style="opacity: {{axisOpacity}};">\n      <line data-key="axisX" x1="0" y1="0" x2="100%" y2="0" stroke="{{axisColor}}" stroke-width="1" transform="translate(0 0)" />\n      <line data-key="axisY" x1="0" y1="0" x2="0" y2="100%" stroke="{{axisColor}}" stroke-width="1" transform="translate(0 0)" />\n    </g>\n\n    <g data-key="cursor" class="{{className}}-cursor" style="opacity: {{cursorOpacity}}; display: none;">\n      <line data-key="cursorX" x1="0" y1="0" x2="100%" y2="0" stroke="{{cursorColor}}" stroke-width="1" transform="translate(0 0)" />\n      <line data-key="cursorY" x1="0" y1="0" x2="0" y2="100%" stroke="{{cursorColor}}" stroke-width="1" transform="translate(0 0)" />\n    </g>\n\n    <svg\n      data-key="workspace"\n      class="{{className}}-workspace"\n      width="1"\n      height="1"\n      viewBox="0 0 1 1"\n      style="position: absolute; overflow: visible; fill: {{fill}}; stroke: {{stroke}}; stroke-width: {{strokeWidth}};"\n      xmlns="http://www.w3.org/2000/svg">\n      <g data-key="bbox"></g>\n    </svg>\n\n  </svg>\n\n  <div\n    data-key="statusbar"\n    class="{{className}}-statusbar"\n    style="position: absolute;">\n    <span data-key="position">x: 0, y: 0</span> | zoom: <span data-key="zoom">100 %</span>\n  </div>\n\n</div>\n',Object.assign({},this.settings,{uid:y})),this.position=new i(0,0),this.cursor=new i(0,0),this.cursorCoords=new i(0,0),this.scale=1,this.gridSize=100,this.pointers=new m(this.parent),this.parent.appendChild(this.elements.blueprint),p(this.elements.statusbar,this.settings.statusbarStyle),this.pointers.on("move",function(t){t.data.primary&&(n.cursorCoords=n.getRelativePosition(t.data.position),n.redrawStatusbar())}),this.pointers.on("tap.end",function(t){2===t.data.tapCount&&n.fit()});var o=null;this.pointers.on("pan.start",function(t){null===o&&(o=t.data.id,n.pan(t.data.panOffsets),n.updateCursorPosition({position:t.data.position,show:!0}))}),this.pointers.on("pan.move",function(t){o===t.data.id&&(n.pan(t.data.movement),n.updateCursorPosition({position:t.data.position,show:!0}))}),this.pointers.on("pan.end",function(t){o===t.data.id&&(n.hide("cursor"),o=null)});var s=null,r=null;this.pointers.on("pinch.start",function(t){o=null,s=1,n.updateCursorPosition({position:r=t.data.pinchMidpoint,show:!0})}),this.pointers.on("pinch.move",function(t){o=null,n.zoom({ratio:n.scale+t.data.pinchRatio-s,target:r}),s=t.data.pinchRatio,n.updateCursorPosition({position:r,show:!0})}),this.pointers.on("pinch.end",function(){n.hide("cursor")}),this.pointers.on("wheel.start",function(t){n.updateCursorPosition({position:t.data.position,show:!0})}),this.pointers.on("wheel.move",function(t){n.zoom({delta:t.data.delta,target:t.data.position}),n.updateCursorPosition({position:t.data.position,show:!0})}),this.pointers.on("wheel.end",function(){n.hide("cursor")})};v.prototype.show=function(t,e){var i=this;void 0===e&&(e=!0),Array.isArray(t)||(t=t.split(/[\s,]+/)),t.forEach(function(t){i.elements[t]&&p(i.elements[t],"display",e?null:"none")})},v.prototype.hide=function(t,e){void 0===e&&(e=!0),this.show(t,!e)},v.prototype.redrawStatusbar=function(){var t=Math.round(100*this.scale),e=t.toString().length-1,i=this.cursorCoords.x.toFixed(e),n=this.cursorCoords.y.toFixed(e);t<1&&(e=this.zoomLimit.min.toFixed(20).replace(/0+$/,"").length-4,t=(100*this.scale).toFixed(e)),this.elements.position.innerText="x: "+i+", y: "+n,this.elements.zoom.innerText=t+" %"},v.prototype.redraw=function(){h(this.elements.axisX,"translate",[0,-this.position.y]),h(this.elements.axisY,"translate",[-this.position.x,0]),h(this.elements.cursorX,"translate",[0,this.cursor.y]),h(this.elements.cursorY,"translate",[this.cursor.x,0]),l(this.elements.gridPattern,"patternTransform","translate("+-this.position.x+", "+-this.position.y+")");var t={width:this.gridSize,height:this.gridSize},e="M "+this.gridSize+" 0 L 0 0 0 "+this.gridSize;if(l(this.elements.gridFill10,t),l(this.elements.gridFill100,t),l(this.elements.gridPattern,t),l(this.elements.gridPattern10,"d",e),l(this.elements.gridPattern100,"d",e),!0===this.settings.nonScalingStroke&&p(this.elements.workspace,"stroke-width",this.settings.strokeWidth/this.scale),l(this.elements.workspace,"viewBox",[this.position.x/this.scale,this.position.y/this.scale,1/this.scale,1/this.scale]),g){var i=this.elements.workspace.cloneNode(!0);this.elements.canvas.replaceChild(i,this.elements.workspace),this.elements.bbox=i.querySelector('[data-key="bbox"]'),this.elements.workspace=i}this.redrawStatusbar()},v.prototype.updateCursorPosition=function(t){void 0===t&&(t={});var e=t.show;void 0===e&&(e=!1),this.cursor=new i(t.position),this.show("cursor",e),this.redraw()},v.prototype.move=function(t){this.position=new i(t),this.redraw()},v.prototype.pan=function(t){this.position=this.position.sub(t),this.redraw()},v.prototype.getWorkspaceCenter=function(){return new i(this.elements.blueprint.offsetWidth/2,this.elements.blueprint.offsetHeight/2)},v.prototype.getRelativePosition=function(t,e){return void 0===e&&(e=null),t.div(e=null===e?this.scale:e).add(this.position.div(e))},v.prototype.zoom=function(t){void 0===t&&(t={});var e=this.scale;"object"!=typeof t&&(t={ratio:t}),null!==(t=Object.assign({},{ratio:1,delta:null,target:null},t)).delta?(t.delta*=this.settings.zoomDirection,this.scale+=t.delta*this.settings.zoomFactor*this.scale):this.scale=t.ratio,this.scale<this.settings.zoomLimit.min?this.scale=this.settings.zoomLimit.min:this.scale>this.settings.zoomLimit.max&&(this.scale=this.settings.zoomLimit.max);var n=this.scale.toString().replace(".","").replace(/e.*/,"").replace(/^0+/,"").replace(/^([1-9])/,"$1.");this.gridSize=100*parseFloat(n),t.target=t.target?new i(t.target):this.getWorkspaceCenter();var o=this.getRelativePosition(t.target,e);this.position=new i(o.x*this.scale-t.target.x,o.y*this.scale-t.target.y),this.redraw()},v.prototype.center=function(){this.move(this.getWorkspaceCenter().neg())},v.prototype.fit=function(){var t=this.elements.bbox.getBoundingClientRect(),e=t.width/this.scale,i=t.height/this.scale;if(e&&i){var n=2*this.settings.fitPadding,o=Math.min((this.elements.blueprint.offsetWidth-n)/e,(this.elements.blueprint.offsetHeight-n)/i);this.zoom(o);var s=this.elements.blueprint.getBoundingClientRect();t=this.elements.bbox.getBoundingClientRect(),this.pan({x:-t.left+s.left+(e=(s.width-t.width)/2),y:-t.top+s.top+(i=(s.height-t.height)/2)})}else this.center()},v.prototype.createElement=function(t,e){return void 0===e&&(e={}),function(t,e){var i,o,s;return void 0===e&&(e=null),s="<"===t.charAt(0)?(i='<svg xmlns="'+n+'">'+t+"</svg>",void 0===o&&(o="application/xml"),(new DOMParser).parseFromString(i,o)).documentElement.firstChild:document.createElementNS(n,t),null!==e&&l(s,e),s}(t,Object.assign({},{"stroke-width":null,stroke:this.settings.stroke,fill:this.settings.fill,style:{"stroke-width":null,stroke:null,fill:null}},e))},v.prototype.append=function(t,e){void 0===e&&(e={});var i=this.createElement(t,e);return this.elements.bbox.appendChild(i),i},v.prototype.remove=function(t){"string"==typeof t&&(t=this.elements.bbox.querySelector(t)),this.elements.bbox.removeChild(t)},t.settings=e,t.Blueprint=v});
//# sourceMappingURL=svg-blueprint.umd.js.map
